# Version Parsing for qmake Builds

This document describes how SQLiteStudio version is automatically extracted from source code and made available to qmake builds.

## Overview

The version number is defined in `coreSQLiteStudio/sqlitestudio.cpp` as:
```cpp
static const int sqlitestudioVersion = 40000;
```

The `version.pri` file automatically:
1. Extracts this version number from the source file
2. Calculates version components (major, minor, patch)
3. Makes them available as qmake variables and C++ defines

## Version Format

Version is stored as an integer in format `XXYYZZ` where:
- `XX` = Major version
- `YY` = Minor version  
- `ZZ` = Patch version

### Examples:
- `40000` = 4.0.0
- `40102` = 4.1.2
- `30515` = 3.5.15

### Calculation Formula:
```
Major = version / 10000
Minor = (version / 100) % 100
Patch = version % 100
```

## Available Variables

### qmake Variables

These variables are available in any `.pro` file that includes `common.pri`:

- `SQLITESTUDIO_VERSION_INT` - Full version as integer (e.g., 40000)
- `SQLITESTUDIO_VERSION_MAJOR` - Major version number (e.g., 4)
- `SQLITESTUDIO_VERSION_MINOR` - Minor version number (e.g., 0)
- `SQLITESTUDIO_VERSION_PATCH` - Patch version number (e.g., 0)
- `SQLITESTUDIO_VERSION_STRING` - Version string (e.g., "4.0.0")

### C++ Defines

The same variables are available as preprocessor defines in C++ code:

```cpp
#define SQLITESTUDIO_VERSION_INT 40000
#define SQLITESTUDIO_VERSION_MAJOR 4
#define SQLITESTUDIO_VERSION_MINOR 0
#define SQLITESTUDIO_VERSION_PATCH 0
#define SQLITESTUDIO_VERSION_STRING "4.0.0"
```

## Usage Examples

### In qmake .pro files:

```qmake
# Use version in conditional logic
greaterThan(SQLITESTUDIO_VERSION_MAJOR, 3) {
    message("Building with SQLiteStudio 4.x")
}

# Use in custom targets
message("Building SQLiteStudio $$SQLITESTUDIO_VERSION_STRING")

# Use in file paths or names
OUTPUT_FILE = sqlitestudio-$$SQLITESTUDIO_VERSION_STRING.exe
```

### In C++ code:

```cpp
#include <iostream>

void printVersion() {
    std::cout << "SQLiteStudio version: " 
              << SQLITESTUDIO_VERSION_STRING << std::endl;
    std::cout << "Version code: " 
              << SQLITESTUDIO_VERSION_INT << std::endl;
}

#if SQLITESTUDIO_VERSION_MAJOR >= 4
    // Code specific to version 4.x and later
#endif
```

## Requirements

- **Python**: Python 2.7+ or Python 3.x must be available in PATH
  - On Windows: Usually included with Qt SDK
  - On Linux/macOS: Pre-installed or easily available via package manager

## Implementation Details

### Files Modified:

1. **SQLiteStudio3/version.pri** (new)
   - Core version parsing logic
   - Reads version from sqlitestudio.cpp
   - Calculates version components using Python
   - Exports variables and defines

2. **SQLiteStudio3/SQLiteStudio3.pro** (modified)
   - Includes version.pri at root project level

3. **SQLiteStudio3/common.pri** (modified)
   - Includes version.pri for all subprojects

4. **.gitignore** (modified)
   - Excludes generated calc_version.py script
   - Excludes generated Makefiles

### How It Works:

1. **Extraction**: Uses qmake's `cat()` function to read sqlitestudio.cpp line by line
2. **Parsing**: Finds the line containing `static const int sqlitestudioVersion` and extracts the number
3. **Calculation**: Creates a temporary Python script to calculate major/minor/patch components
4. **Export**: Makes variables available via qmake `export()` and as C++ `DEFINES`

### Cross-Platform Compatibility:

- **Windows**: Uses `python` or `python3` command, with `2>NUL` for error suppression
- **Unix/Linux/macOS**: Uses `python3` or `python` command, with `2>/dev/null` for error suppression
- **QtCreator**: Works seamlessly in QtCreator on all platforms

## Troubleshooting

### Error: "Could not extract version from ..."

**Cause**: The version.pri file couldn't find or parse the version number in sqlitestudio.cpp

**Solution**: 
- Ensure `coreSQLiteStudio/sqlitestudio.cpp` exists
- Verify it contains a line: `static const int sqlitestudioVersion = XXXXX;`

### Error: "Python is required for building SQLiteStudio"

**Cause**: Python is not installed or not in PATH

**Solution**:
- Install Python 2.7+ or Python 3.x
- Ensure it's added to your system PATH
- On Windows, Python usually comes with Qt SDK
- Test by running `python --version` or `python3 --version`

### Generated Files Appearing in Git

The following files are automatically generated during qmake configuration and should not be committed:
- `calc_version.py` - Temporary Python script for version calculation
- `Makefile` - Generated by qmake

These are already in `.gitignore`.

## Updating the Version

To update the SQLiteStudio version:

1. Edit `SQLiteStudio3/coreSQLiteStudio/sqlitestudio.cpp`
2. Change the value of `sqlitestudioVersion`
3. Run `qmake` to regenerate build files
4. The new version will automatically be used throughout the build

Example:
```cpp
// Change from:
static const int sqlitestudioVersion = 40000;  // 4.0.0

// To:
static const int sqlitestudioVersion = 40100;  // 4.1.0
```

No other files need to be modified - the version parsing is automatic.
